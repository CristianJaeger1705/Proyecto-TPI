<style>
/* ---------------------------------------------
   üé® FORMULARIOS MODERNOS
   --------------------------------------------- */

/* Contenedor principal del formulario */
.form-modern {
    background: #ffffff;
    padding: 40px;
    border-radius: 18px;
    box-shadow: 0px 6px 25px rgba(0, 0, 0, 0.08);
    transition: 0.3s ease;
}

.form-modern:hover {
    transform: translateY(-2px);
}

/* T√≠tulo */
.form-modern h2 {
    font-weight: 700;
    color: #2c3e50;
}

/* ---------------------------------------------
   üìù Inputs, selects y textareas
   --------------------------------------------- */
.form-modern input,
.form-modern textarea,
.form-modern select {
    width: 100%;
    border-radius: 12px !important;
    padding: 12px 16px !important;
    border: 1px solid #dce1e7;
    background: #f7f9fc;
    font-size: 15px;
    transition: 0.25s ease;
    margin-bottom: 18px;
}

.form-modern input:focus,
.form-modern textarea:focus,
.form-modern select:focus {
    background: #ffffff;
    border-color: #6a74ff !important;
    box-shadow: 0 0 0 3px rgba(106, 116, 255, 0.25) !important;
}

/* ---------------------------------------------
   üéõÔ∏è Mejoras visuales de Labels
   --------------------------------------------- */
.form-modern label {
    font-weight: 600;
    color: #3b3f48;
    margin-bottom: 6px;
    display: block;
}

/* ---------------------------------------------
   üîò Bot√≥n moderno
   --------------------------------------------- */
.btn-modern {
    background: linear-gradient(135deg, #6a74ff, #4a54e1);
    color: white !important;
    padding: 12px 20px;
    border-radius: 12px;
    font-weight: 600;
    width: 100%;
    border: none;
    transition: 0.3s ease;
    cursor: pointer;
}

.btn-modern:hover {
    background: linear-gradient(135deg, #4a54e1, #343ccf);
    transform: translateY(-2px);
}

/* ---------------------------------------------
   üñºÔ∏è Imagen (logo) vista previa
   --------------------------------------------- */
.logo-preview {
    max-height: 120px;
    border-radius: 14px;
    display: block;
    margin: 0 auto 20px auto;
}

/* ---------------------------------------------
   üì± Responsive
   --------------------------------------------- */
@media (max-width: 768px) {
    .form-modern {
        padding: 25px;
    }
}
</style>



{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{% block meta_description %}Encuentra tu pr√≥ximo empleo o el candidato ideal{% endblock %}">
    <title>{% block title %}Bolsa de Trabajo{% endblock %}</title>
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
    <script src="{% static 'js/modals.js' %}"></script>

    {% block extra_css %}{% endblock %}

    <!-- üîê Script para cerrar sesi√≥n con SweetAlert -->
    <script>
    document.addEventListener("DOMContentLoaded", function () {
        const logoutBtn = document.getElementById("btnLogout");
        const logoutForm = document.getElementById("logoutForm");

        if (logoutBtn) {
            logoutBtn.addEventListener("click", function (e) {
                e.preventDefault();

                Swal.fire({
                    title: "¬øSeguro que deseas cerrar sesi√≥n?",
                    text: "Tu sesi√≥n actual se cerrar√°.",
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonText: "S√≠, cerrar",
                    cancelButtonText: "Cancelar",
                }).then((result) => {
                    if (result.isConfirmed) {
                        logoutForm.submit();
                    }
                });
            });
        }
    });
    </script>

</head>
<body>





    <!-- Navbar -->
    {% include 'components/navbar.html' %}
    
    <!-- Messages/Alerts -->
    {% include 'includes/messages.html' %}
    
    <!-- Main Content -->
    <main class="{% block main_class %}main-content{% endblock %}">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    {% include 'components/footer.html' %}
    
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{% static 'js/custom.js' %}"></script>

    <!-- üîä Audio de notificaci√≥n -->
    <audio id="soundNotif" src="{% static 'sonidos/notificacion.mp3' %}" preload="auto"></audio>

    <!-- üìå Permiso para mostrar notificaciones -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        });
    </script>

    <!-- üîî Sistema unificado de notificaciones -->
    <script>
    // CSRF helper
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
            const cookies = document.cookie.split(";").map(c => c.trim());
            for (const cookie of cookies) {
                if (cookie.startsWith(name + "=")) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    const CSRF = getCookie("csrftoken");

    // üîä Reproducir sonido
    function reproducirNotificacion() {
        const audio = document.getElementById("soundNotif");
        if (audio) {
            audio.currentTime = 0;
            audio.play().catch(() => {});
        }
    }

    // üñ•Ô∏è Crear notificaci√≥n de escritorio
    function mostrarNotificacion(titulo, cuerpo) {
        if (Notification.permission === "granted") {
            const noti = new Notification(titulo, {
                body: cuerpo,
                icon: "/static/icono_notificacion.png"
            });
            noti.onclick = () => window.open("/mensajeria/");
        }
    }

    // üîî Revisar nuevas notificaciones y alertas
    async function revisarNotificaciones() {
        try {
            const res = await fetch("/mensajeria/api/nuevas/");
            if (!res.ok) return;
            const data = await res.json();

            if (data.nuevas > 0) {
                reproducirNotificacion();
                mostrarNotificacion("Tienes nuevas notificaciones", "Haz click para revisarlas.");
            }

            const tbody = document.querySelector("#tabla-notificaciones tbody");
            if (tbody && data.detalles) {
                data.detalles.forEach(n => {
                    if (document.querySelector(`[data-id-notif="${n.id}"]`)) return;

                    const tr = document.createElement("tr");
                    tr.dataset.idNotif = n.id;
                    tr.innerHTML = `
                        <td>${n.tipo}</td>
                        <td>${n.mensaje}</td>
                        <td>${n.fecha}</td>
                        <td><button class="btn btn-sm btn-success" onclick="marcarLeida(${n.id})">Marcar le√≠da</button></td>
                    `;
                    tbody.appendChild(tr);
                });
            }

        } catch (e) {
            console.log("Error obteniendo notificaciones", e);
        }
    }

    // Marcar notificaci√≥n como le√≠da
    async function marcarLeida(id) {
        try {
            const res = await fetch(`/mensajeria/ajax/notificaciones/marcar/${id}/`, { 
                method: "POST", 
                headers: {"X-CSRFToken": CSRF} 
            });
            if (res.ok) {
                const tr = document.querySelector(`[data-id-notif="${id}"]`);
                if (tr) tr.remove();
            }
        } catch (err) {
            console.log("Error al marcar como le√≠da:", err);
        }
    }

    // Inicializar
    setInterval(revisarNotificaciones, 15000);
    document.addEventListener("DOMContentLoaded", revisarNotificaciones);
    </script>

    <!-- Librer√≠as -->
    <script src="{% static 'js/sweetalert.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{% static 'js/geolocation.js' %}"></script>
    <script src="{% static 'js/modals.js' %}"></script>

    {% block extra_js %}{% endblock %}
</body>
</html>
